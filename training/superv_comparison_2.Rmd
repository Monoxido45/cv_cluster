---
title: "Supervision comparissons"
author: "Luben Miguel"
date: "08/02/2021"
output: html_document
---
```{r global_options}
knitr::opts_chunk$set(echo = T, out.width = '85%', fig.align = "center", warning = F)
```
Importing needed packages
```{r message = FALSE}
library(ape)
library(dendextend)
library(cluster)
library(tibble)
library(magrittr)
library(dplyr)
library(phytools)
library(mltools)
library(data.table)
library(factoextra)
source("C:/Users/lucru/Estatística_UFSCar/cv_cluster/modules/convert_to_parenthesis.R")
source("C:/Users/lucru/Estatística_UFSCar/cv_cluster/modules/cv_score.R")
library(tictoc)
library(mvMORPH)
library(dplyr)
library(tidyr)
library(RColorBrewer)
library(MASS)
library(kableExtra)
library(plyr)
library(clValid)
```
To facilitate all investigations on several datasets (including simulated ones), we can draft a function that make pairwise graphs of FOM and our score versus the other variables:
```{r}
# function for default score:
display.superv_comp = function(data, clust.list, test_index, dist = NA){
  k = nlevels(data[, test_index])
  data.test = all_supervised_comparing(data, clust = clust.list, test_index = test_index, dist = dist)
  fom.test = FOM(data[, -(test_index)], nlvls = k, clust.list, dist)
  # arranging datas
  fom.test = fom.test %>%
  dplyr::arrange(V2)
  data.test = data.test %>%
  dplyr::arrange(V4)
  fom.test$V1 = as.numeric(fom.test$V1)
  data.test$FOM = fom.test$V1
  
  # graphing and displaying correlations
  g1 = data.test %>%
  ggplot(aes(x = V1, y = V3, colour = V4)) +
  geom_point() +
  theme_minimal() +
  labs(x = "Proportion of hits",
       y = "Scores",
       colour = "Distances",
       title = "Scatterplot of proportion of hits versus Score values 
       according to different distances") +
  theme(text = element_text(size = 11, 
                            family ="serif"),
        plot.title = element_text(hjust = 0.5)) +
  scale_colour_brewer(palette = "Set1")
  
  g2 = data.test %>%
  ggplot(aes(x = V2, y = V3, colour = V4)) +
  geom_point() +
  theme_minimal() +
  labs(x = "F1 score",
       y = "Scores",
       colour = "Distances",
       title = "Scatterplot of F1 versus Score values 
       according to different distances") +
  theme(text = element_text(size = 11, 
                            family ="serif"),
        plot.title = element_text(hjust = 0.5)) +
  scale_colour_brewer(palette = "Set1")
  
  g3 = data.test %>%
  ggplot(aes(x = FOM, y = V3, colour = V4)) +
  geom_point() +
  theme_minimal() +
  labs(x = "FOM score",
       y = "Scores",
       colour = "Distances",
       title = "Scatterplot of FOM versus Score values 
       according to different distances") +
  theme(text = element_text(size = 11, 
                            family ="serif"),
        plot.title = element_text(hjust = 0.5)) +
  scale_colour_brewer(palette = "Set1")
  
  g4 = data.test %>%
  ggplot(aes(x = V1, y = FOM, colour = V4)) +
  geom_point() +
  theme_minimal() +
  labs(x = "Proportion of hits",
       y = "Scores",
       colour = "Distances",
       title = "Scatterplot of proportion of hits versus FOM Score values 
       according to different distances") +
  theme(text = element_text(size = 11, 
                            family ="serif"),
        plot.title = element_text(hjust = 0.5)) +
  scale_colour_brewer(palette = "Set1")
  
  g5 = data.test %>%
  ggplot(aes(x = V2, y = FOM, colour = V4)) +
  geom_point() +
  theme_minimal() +
  labs(x = "F1 score",
       y = "Scores",
       colour = "Distances",
       title = "Scatterplot of F1 versus FOM Score values 
       according to different distances") +
  theme(text = element_text(size = 11, 
                            family ="serif"),
        plot.title = element_text(hjust = 0.5)) +
  scale_colour_brewer(palette = "Set1")
  
  show(g1)
  show(g2)
  show(g3)
  cat("Correlations between score and other variables: \n")
  cat("Score versus proportion of hits: ", cor(data.test$V3, data.test$V1, method = "spearman"), "\n")
  cat("Score versus F1: ", cor(data.test$V3, data.test$V2, method = "spearman"), "\n")
  cat("Score versus FOM: ", cor(data.test$V3, data.test$FOM, method = "spearman"), "\n")
  
  show(g4)
  show(g5)
  cat("Correlations between FOM and other variables: \n")
  cat("FOM versus F1: ", cor(data.test$FOM, data.test$V2, method = "spearman"), "\n")
  cat("FOM versus proportion of hits: ", cor(data.test$FOM, data.test$V1, method = "spearman"), "\n")
  return(data.test)
}

CV_display.superv_comp = function(data, clust.list, test_index, dist = NA){
  k = nlevels(data[, test_index])
  data.test = supervised_comparing_L_cross_val(data, clust.list, test_index = test_index, dists = dist)
  fom.test = FOM(data[, -(test_index)], nlvls = k, clust.list, dist)
  # arranging datas
  
  data.test = data.test %>%
  dplyr::arrange(V2)
  
  fom.test$V1 = as.numeric(fom.test$V1)
  fom.test = fom.test %>%
  dplyr::arrange(V2)
  data.test$FOM = fom.test$V1
  
  # graphing and displaying correlations
  g1 = data.test %>%
  ggplot(aes(x = hits, y = V1, colour = V2)) +
  geom_point() +
  theme_minimal() +
  labs(x = "Proportion of hits",
       y = "Scores",
       colour = "Distances",
       title = "Scatterplot of proportion of hits versus Score values 
       according to different distances") +
  theme(text = element_text(size = 11, 
                            family ="serif"),
        plot.title = element_text(hjust = 0.5)) +
  scale_colour_brewer(palette = "Set1")
  
  g2 = data.test %>%
  ggplot(aes(x = F1, y = V1, colour = V2)) +
  geom_point() +
  theme_minimal() +
  labs(x = "F1 score",
       y = "Scores",
       colour = "Distances",
       title = "Scatterplot of F1 versus Score values 
       according to different distances") +
  theme(text = element_text(size = 11, 
                            family ="serif"),
        plot.title = element_text(hjust = 0.5)) +
  scale_colour_brewer(palette = "Set1")
  
  g3 = data.test %>%
  ggplot(aes(x = FOM, y = V1, colour = V2)) +
  geom_point() +
  theme_minimal() +
  labs(x = "FOM score",
       y = "Scores",
       colour = "Distances",
       title = "Scatterplot of FOM versus Score values 
       according to different distances") +
  theme(text = element_text(size = 11, 
                            family ="serif"),
        plot.title = element_text(hjust = 0.5)) +
  scale_colour_brewer(palette = "Set1")
  
  g4 = data.test %>%
  ggplot(aes(x = hits, y = FOM, colour = V2)) +
  geom_point() +
  theme_minimal() +
  labs(x = "Proportion of hits",
       y = "Scores",
       colour = "Distances",
       title = "Scatterplot of proportion of hits versus FOM Score values 
       according to different distances") +
  theme(text = element_text(size = 11, 
                            family ="serif"),
        plot.title = element_text(hjust = 0.5)) +
  scale_colour_brewer(palette = "Set1")
  
  g5 = data.test %>%
  ggplot(aes(x = F1, y = FOM, colour = V2)) +
  geom_point() +
  theme_minimal() +
  labs(x = "F1 score",
       y = "Scores",
       colour = "Distances",
       title = "Scatterplot of F1 versus FOM Score values 
       according to different distances") +
  theme(text = element_text(size = 11, 
                            family ="serif"),
        plot.title = element_text(hjust = 0.5)) +
  scale_colour_brewer(palette = "Set1")
  
  show(g1)
  show(g2)
  show(g3)
  cat("Correlations between cross validated score and other variables: \n")
  cat("Score versus proportion of hits: ", cor(data.test$V1, data.test$hits, method = "spearman"), "\n")
  cat("Score versus F1: ", cor(data.test$V1, data.test$F1, method = "spearman"), "\n")
  cat("Score versus FOM: ", cor(data.test$V1, data.test$FOM, method = "spearman"), "\n")
  
  show(g4)
  show(g5)
  cat("Correlations between FOM and other variables: \n")
  cat("FOM versus F1: ", cor(data.test$FOM, data.test$hits, method = "spearman"), "\n")
  cat("FOM versus proportion of hits: ", cor(data.test$FOM, data.test$F1, method = "spearman"), "\n")
  return(data.test)
}

data.generator = function(n, mu_0, mu_1, p = 2, S = NULL, seed = 500){
  set.seed(seed)
  Y = sample(c(0, 1), n, replace = TRUE, prob = c(0.5, 0.5))
  if(is.null(S) == T) S = diag(nrow = p, ncol = p)
  X = matrix(nrow = n, ncol = p)
  X[Y == 0, ] = round(mvrnorm(sum(Y == 0), mu_0, S), 4)
  X[Y == 1, ] = round(mvrnorm(sum(Y == 1), mu_1, S), 4)

  sim.data = as.data.frame(cbind(X , Y))
  sim.data$Y = as.factor(Y)
  if(p == 2){
  colnames(sim.data) = c("X1", "X2", "Y")}
  row.names(sim.data) = c(1:nrow(sim.data))
  return(sim.data)
}
```
Repeating simulation again:
```{r}
# fixing parameters
n = 170
p = 2
mu_0 = c(0, 0)
mu_1 = c(1, 2)
S = cbind(c(2, 1), c(1, 3))
sim.data = data.generator(n, mu_0, mu_1, S = S)
head(sim.data, 4)
```
Defining a test list and distance vector for further supervision comparissons:
```{r}
# excluding centroid
test.list = list(hclust = c("ward.D", "single","ward.D2", "average", "complete", "mcquitty", "median"), agnes = c("weighted", "average", "ward"), diana = NA)
dists = c("euclidean", "manhattan", "canberra")
```
```{r}
display.superv_comp(sim.data, test.list, test_index = 3, dist = dists)
```
For separated data:
```{r}
n = 170
p = 2
mu_0 = c(0, 0)
mu_1 = c(6, 8)
sim.data = data.generator(n, mu_0, mu_1, seed = 150)
head(sim.data, 4)
```
```{r}
sim.test_1 = display.superv_comp(sim.data, test.list, test_index = 3, dist = dists)
```
```{r}
n = 500
p = 2
mu_0 = c(0, 0)
mu_1 = c(2, 2)
sim.data = data.generator(n, mu_0, mu_1, seed = 150)
head(sim.data, 4)
```
```{r}
sim.test_2 = display.superv_comp(sim.data, test.list, test_index = 3, dist = dists)
```
```{r}
flowers = iris
flowers.test = display.superv_comp(flowers, test.list, test_index = 5, dist = dists)
```
```{r}
n = 170
p = 2
mu_0 = c(0, 0)
mu_1 = c(1, 2)
S = cbind(c(2, 1), c(1, 3))
sim.data = data.generator(n, mu_0, mu_1, S = S)
head(sim.data, 4)
```
```{r}
tic("Running time for cv_superv_comp")
cv_sim.test = CV_display.superv_comp(sim.data, test.list, test_index = 3, dist = dists)
toc()
```
Importing and testing real datasets: \
**Prima indians diabetes dataset**
```{r}
n = 300
# prima indians dataset
library(data.table)
prima_data <- as.data.frame(fread('https://raw.githubusercontent.com/jbrownlee/Datasets/master/pima-indians-diabetes.csv'))
chosen_rows = sample(1:nrow(prima_data), n, replace = F)
prima_data = prima_data[chosen_rows, ]
# selecting rows (too many samples)
prima_data$V9 = as.factor(prima_data$V9)
head(prima_data)
```
```{r}
tic("Running time for supervisioned comparisson in prima indians diabetes dataset")
prima_data.test = display.superv_comp(prima_data, test.list, test_index = 9, dist = dists)
toc()
```
**Wheat seeds dataset**
```{r}
# wheat seeds dataset
wheat_data = read.delim("C:/Users/lucru/Estatística_UFSCar/cv_cluster/data/seeds_dataset.txt")
wheat_data$X1 = as.factor(wheat_data$X1)
head(wheat_data)
```
```{r}
tic("Running time for supervisioned comparisson in wheat seeds dataset")
display.superv_comp(wheat_data, test.list, test_index = 8, dist = dists)
toc()
```
\
**Prima indians diabetes dataset**
```{r}
# prima indians dataset
library(data.table)
prima_data <- as.data.frame(fread('https://raw.githubusercontent.com/jbrownlee/Datasets/master/pima-indians-diabetes.csv'))
# selecting rows (too many samples)
prima_data$V9 = as.factor(prima_data$V9)
head(prima_data)
```
```{r}
tic("Running time for supervisioned comparisson in prima indians diabetes dataset")
display.superv_comp(prima_data, test.list, test_index = 9, dist = dists)
toc()
```
\
**Ionosphere dataset**
```{r}
ionosphere_data = as.data.frame(read.table("https://archive.ics.uci.edu/ml/machine-learning-databases/ionosphere/ionosphere.data", sep = ","))
ionosphere_data$V35 = as.factor(ionosphere_data$V35)
head(ionosphere_data)
```
```{r}
tic("Running time for supervisioned comparisson in ionosphere dataset")
display.superv_comp(ionosphere_data, test.list, test_index = 35, dist = dists)
toc()
```